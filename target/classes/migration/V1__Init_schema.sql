CREATE TABLE dh_encounters
(
    enct_code  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    pat_id     BIGINT                                  NOT NULL,
    enct_start TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
    enct_end   TIMESTAMP WITHOUT TIME ZONE,
    enct_class VARCHAR(50)                             NOT NULL,
    CONSTRAINT pk_dh_encounters PRIMARY KEY (enct_code)
);

CREATE TABLE dh_observations
(
    obs_id    BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    obs_date  TIMESTAMP WITHOUT TIME ZONE,
    obs_type  VARCHAR(255),
    obs_value VARCHAR(255),
    pat_id    BIGINT,
    CONSTRAINT pk_dh_observations PRIMARY KEY (obs_id)
);

CREATE TABLE dh_patients
(
    pat_id         BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    pat_identifier BIGINT                                  NOT NULL,
    pat_given_name VARCHAR(255)                            NOT NULL,
    pat_fam_name   VARCHAR(255)                            NOT NULL,
    pat_birth_date date                                    NOT NULL,
    pat_gender     VARCHAR(255)                            NOT NULL,
    CONSTRAINT pk_dh_patients PRIMARY KEY (pat_id)
);

ALTER TABLE dh_patients
    ADD CONSTRAINT uc_dh_patients_pat_identifier UNIQUE (pat_identifier);

CREATE INDEX idx_enct_end ON dh_encounters (enct_end);

CREATE INDEX idx_enct_start ON dh_encounters (enct_start);

CREATE INDEX idx_pat_birth_date ON dh_patients (pat_birth_date);

CREATE INDEX idx_pat_fam_name ON dh_patients (pat_fam_name);

CREATE INDEX idx_pat_given_name ON dh_patients (pat_given_name);

ALTER TABLE dh_encounters
    ADD CONSTRAINT FK_DH_ENCOUNTERS_ON_PAT FOREIGN KEY (pat_id) REFERENCES dh_patients (pat_id);

CREATE INDEX idx_enct_pat_id ON dh_encounters (pat_id);

ALTER TABLE dh_observations
    ADD CONSTRAINT FK_DH_OBSERVATIONS_ON_PAT FOREIGN KEY (pat_id) REFERENCES dh_patients (pat_id);